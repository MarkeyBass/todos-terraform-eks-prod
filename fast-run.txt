Connect to the Cluster
-----------------------
*) Adding context to kubectl
    ğŸ’² cat ~/.kube/config
    ğŸ’² cat ~/.kube/config > ./meta/kube_config_old_3.txt
    ğŸ’² rm ~/.kube/config
    
ğŸ’² terraform init
ğŸ’² terraform apply -auto-approve


Connect to the EKS claster
    ğŸ’² aws eks --region us-west-2 update-kubeconfig --name eks --profile terraform

    ğŸ’² kubectl get svc


*) run todos-k8s-prod cluster
-------------------------------- 
ğŸ’²
kubectl apply -f 0-project-namespace.yaml
kubectl apply -f 3-mysql.yaml
kubectl apply -f 4-adminer.yaml
kubectl apply -f 5-todos-server.yaml

ğŸ’² kubectl get svc -n todos
NAME                   TYPE           CLUSTER-IP       EXTERNAL-IP                                                               PORT(S)        AGE
adminer-service        LoadBalancer   10.100.166.97    abd8747e1affc4f8db5eb4b658a7c687-1231382294.us-west-2.elb.amazonaws.com   80:30001/TCP   12m
mysql-service          ClusterIP      10.100.71.139    <none>                                                                    3306/TCP       12m
todos-server-service   LoadBalancer   10.100.186.128   a9c913c6352294ee3a907acc879773f9-2070628649.us-west-2.elb.amazonaws.com   80:30002/TCP   8s

*) Monitoring
================

linux helm installation
------------------------
ğŸ’² wget https://get.helm.sh/helm-v3.9.3-linux-amd64.tar.gz
ğŸ’² tar xvf helm-v3.9.3-linux-amd64.tar.gz
ğŸ’² sudo mv linux-amd64/helm /usr/local/bin
ğŸ’² helm version

doanload prometheus repo
-------------------------
ğŸ’² helm repo add prometheus-community https://prometheus-community.github.io/helm-charts
ğŸ’² helm repo update
ğŸ’² kubectl create namespace prometheus

××¢×“×›×Ÿ ××ª ×”×¨×›×™×‘ ×©×œ ×¤×¨×•××™×˜×™×•×¡ - ×¤×•×¨×¡ ×¨×™×¡×•×¨×¡×™× ×©×œ ×¤×¨×•××™×˜×™×•×¡ ×‘×ª×•×š ×”× ×™×™××¡×¤×™×™×¡ ×‘×××¦×¢×•×ª ×”××œ×
ğŸ’² helm install prometheus prometheus-community/prometheus --namespace prometheus

convert prometheus-kube-state-metrics ClusterIP into NodePort service with the following command.
This is required to access prometheus-server using your browser.

ğŸ’² kubectl expose service prometheus-server --type=NodePort --target-port=9090 --name=prometheus-server-ext -n prometheus
ğŸ’² kubectl get svc -n prometheus
ğŸ“¤ prometheus-server-ext                 NodePort    10.100.132.110   <none>        80:30580/TCP   32s
http://10.100.132.110:30580/

oanload grafana repo
-------------------------
ğŸ’² helm repo add grafana https://grafana.github.io/helm-charts
ğŸ’² helm repo update
ğŸ’² kubectl create namespace grafana

××¢×“×›×Ÿ ××ª ×”×¨×›×™×‘ ×©×œ ×’×¨×¤× ×” - ×¤×•×¨×¡ ×¨×™×¡×•×¨×¡×™× ×©×œ ×’×¨×¤× ×” ×‘×ª×•×š ×”× ×™×™××¡×¤×™×™×¡ ×‘×××¦×¢×•×ª ×”××œ×
ğŸ’² helm install grafana grafana/grafana --namespace grafana

ğŸ’² kubectl get all --namespace prometheus
ğŸ’² kubectl get all --namespace grafana



get admin password for grafana
-------------------------------
ğŸ’² kubectl get secret --namespace grafana grafana -o jsonpath="{.data.admin-password}" | base64 --decode ; echo
FBZnuZVeCFK9IPU8iTtnH8YMnB5PiVtNQgqHyixw




*) Remove All namespace and delete all the relevant k8s components
======================================================================

â—ğŸ’² kubectl delete namespace todos
â—ğŸ’² kubectl get svc -n todos
â—ğŸ’² kubectl get svc

â—ğŸ’² kubectl delete namespace prometheus
â—ğŸ’² kubectl get svc -n prometheus
â—ğŸ’² kubectl get svc

â—ğŸ’² kubectl delete namespace grafana
â—ğŸ’² kubectl get svc -n grafana
â—ğŸ’² kubectl get svc

â—ğŸ’² terraform destroy -auto-approve